# Demographic
demographic:
  - root: //*[local-name()='patient']
    generated_id:
      # random uuid4
      namespace: 7fdd5f16-188e-4dae-89bb-c207427db3a7
      name: ./shared:bcr_patient_uuid
    edges:
      describes:
        case:
          path: ./shared:bcr_patient_uuid
    properties:
      submitter_id:
        # xpath support concat too, but it will return the suffix
        # if no path is found instead of not found
        path: //*[local-name()='bcr_patient_barcode']
        suffix: _demographic
        type: str

      gender:
        path: //*[local-name()='gender']
        type: str.lower
        default: not reported

      race:
        path: //*[local-name()='race']|./clin_shared:race_list/clin_shared:race[1]
        type: str.lower
        default: not reported

      ethnicity:
        path: //*[local-name()='ethnicity']
        type: str.lower
        default: not reported

      year_of_birth:
        path: //*[local-name()='year_of_initial_pathologic_diagnosis'] - //*[local-name()='age_at_initial_pathologic_diagnosis']
        type: int

      year_of_death:
        path: //*[local-name()='year_of_initial_pathologic_diagnosis'] + floor(//*[local-name()='days_to_death'] div 365)
        type: int

diagnosis:
  - root: //*[local-name()='patient']
    # roots to lookup property
    additional_property_roots:
      - //*[local-name()='follow_up']
    generated_id:
      namespace: 0e34df64-b3ab-4b07-b750-e8690ee28eaf
      name: ./shared:bcr_patient_uuid
    edges:
      describes:
        case:
          path: ./shared:bcr_patient_uuid
    properties:
      submitter_id:
        path: ./shared:bcr_patient_barcode
        suffix: _diagnosis
        type: str

      age_at_diagnosis:
        path: //*[local-name()='days_to_birth'] * -1
        type: float
        maximum: 32872
        minimum: 0
        term:

      days_to_birth:
        path: //*[local-name()='days_to_birth']
        type: float
        minimum: -32872
        maximum: 0

      days_to_death:
        path: //*[local-name()='days_to_death']
        type: float
        maximum: 32872
        minimum: 0

      days_to_last_follow_up:
        path: //*[local-name()='days_to_last_followup']
        type: float

      vital_status:
        path: //*[local-name()='vital_status']
        type: str.lower
        default: not reported

      primary_diagnosis:
        path: //*[local-name()='histological_type']
        type: str.lower
        default: not reported

      morphology:
        path: //*[local-name()='icd_o_3_histology']
        type: str.lower
        default: not reported

      tissue_or_organ_of_origin:
        path: //*[local-name()='tumor_tissue_site']
        type: str.lower
        default: not reported

      site_of_resection_or_biopsy:
        path: //*[local-name()='icd_o_3_site']
        type: str.lower
        default: not reported

      classification_of_tumor:
        path: //bio:sample_type
        type: str.lower
        default: not reported

      prior_malignancy:
        path: ./shared:prior_dx
        default: not reported
        type: str.lower

      tumor_stage:
        path: //*[local-name()='pathologic_stage']
        type: str.lower
        default: not reported

      tumor_grade:
        path: //shared:neoplasm_histologic_grade
        type: str.lower
        default: not reported

      progression_or_recurrence:
        path: //*[local-name()='new_tumor_event_after_initial_treatment']
        type: str.lower
        default: not reported

      days_to_recurrence:
        path: //*[local-name()='days_to_new_tumor_event_after_initial_treatment']
        type: int
        default: not reported

      last_known_disease_status:
        path: //*[local-name()='person_neoplasm_cancer_status']
        type: str.capitalize
        default: not reported

      days_to_last_known_disease_status:
        path: //*[local-name()='days_to_last_followup']
        type: int
        default: not reported

exposure:
  - root: //*[local-name()='patient']
    generated_id:
      namespace: 4950f39b-2f3d-48c5-8e98-04178697ff13
      name: ./shared:bcr_patient_uuid

    edges:
      describes:
        case:
          path: ./shared:bcr_patient_uuid

    properties:
      submitter_id:
        path: ./shared:bcr_patient_barcode
        suffix: _exposure
        type: str

      years_smoked:
        path: ./shared:stopped_smoking_year|./clin_shared:stopped_smoking_year - ./shared:year_of_tobacco_smoking_onset|./clin_shared:year_of_tobacco_smoking_onset
        type: float

      cigarettes_per_day:
        path: ./clin_shared:number_pack_years_smoked * 20 div 365
        type: float

      alcohol_history:
        path: "./clin_shared:alcohol_history_documented"
        type: str.lower

      alcohol_intensity:
        path: "unknown"
        type: str.lower

      height:
        path: "./clin_shared:height"
        type: float

      weight:
        path: "./clin_shared:weight"
        type: float

      bmi:
        path: "./clin_shared:weight div (./clin_shared:height * ./clin_shared:height * 0.0001)"
        type: float

treatment:
  - root: //*[local-name()='patient']
    generated_id:
      namespace: 68222794-8b3b-4d1b-a944-49b7d9a0443e
      name: ./shared:bcr_patient_uuid

    edges_by_property:
      describes:
        diagnosis: 
          submitter_id: 
            path: ./shared:bcr_patient_barcode
            suffix: _diagnosis

    properties:
      submitter_id:
        path: ./shared:bcr_patient_barcode
        suffix: _treatment
        type: str

      treatment_or_therapy:
        path: ./follow_ups/*/radiation_therapy|./follow_ups/*/postoperative_rx_tx
        term: TBD
        enum:
          - yes
          - no
          - unknown
          - not reported
        type: str.lower
        default: not reported

      treatment_intent_type:
        path: //shared:regimen_indication[first()]
        term: TBD
        type: str

      therapeutic_agents:
        path: //rx:drug_name
        term: TBD
        type: str.lower

      days_to_treatment:
        path: //rx:days_to_drug_therapy_start[first()]|//rad:days_to_radiation_therapy_start[first()]
        term: TBD
        type: int
